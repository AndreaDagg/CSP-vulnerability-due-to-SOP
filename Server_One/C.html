<!DOCTYPE html>
<html>
    <head lang="en">
        <title> Page C - D </title>
        <meta charset="utf-8"> 
    </head>

    <body>
        <h1 style="color: red;">Page C - CSP NON ATTIVO</h1> 
        <p>Vogliamo accedere alla variabile secret in D.html protetto da CSP
            <br><b>D.html</b> viene importato con l'attrubo <b>sandbox</b> questo limita ciò a cui il contenuto incorporato può accedere.<br>
            In console verranno visualizzati: 
            <il>
                <li>Un errore relativo il frame D.html.</li>
                <li>Un errore relativo al tentativo di accesso alla variabile secret in D.html.</li>
            </il>
        </p>

        <div>
            <iframe id="d_frame_id" src="D.html" width="1000px" height="240px" sandbox></iframe>
        </div> 
        <script>
            document.write("Non c'è CSP in C.html quindi è possibile sfruttarlo per eseguire JS in D nonostante lì ci sia CSP");
            
            //Attendiamo che il caricamento sia completo ed eseguiamo l'injection nel frame figlio
            window.onload = function() {
                child_frame = document.getElementById("d_frame_id");
                secret_D = child_frame.contentWindow.secret;
                console.log( "La variabile secret in D è: " + secret_D); 
                child_frame.contentWindow.postMessage(alert("Codice JS iniettato nell'iframe. La variabile SECRET di D è: " + secret_D), "*"); 
            };
            
            
            function goToIndex(){
                window.location.href = "index.html"; 
            }   
        </script>   

        
        <div style="margin-top: 10vh;">
            <button onclick="goToIndex()"> Home Page Server One </button>
        </div>
    </body>
</html> 