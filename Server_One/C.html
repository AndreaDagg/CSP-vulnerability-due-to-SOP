<!DOCTYPE html>
<html>
    <head lang="en">
        <title> Page C - D </title>
        <meta charset="utf-8"> 
        <meta http-equiv="Content-Security-Policy" content="script-src 'self'">
    </head>

    <body>
        <h1 style="color: green;">Page C - CSP ATTIVO - csp replicato</h1>
        <p>Vogliamo accedere alla variabile secret in D.html protetto da CSP <br>
            In questo esempio è presente la replicazione della policy su ogni pagina quindi gli script inline non sono eseguibili in nessuna pagina 
            e non si può sfruttare C.html per eseguirle uno script in D.html
        </p>

        <div>
            <iframe id="d_frame_id" src="D.html" width="1000px" height="240px"></iframe>
        </div> 
        <script>
            document.write("Non c'è CSP in C.html quindi è possibile sfruttarlo per eseguire JS in D nonostante lì ci sia CSP");
            
            //Attendiamo che il caricamento sia completo ed eseguiamo l'injection nel frame figlio
            window.onload = function() {
                child_frame = document.getElementById("d_frame_id");
                secret_D = child_frame.contentWindow.secret;
                console.log( "La variabile secret in D è: " + secret_D); 
                child_frame.contentWindow.postMessage(alert("Codice JS iniettato nell'iframe. La variabile SECRET di D è: " + secret_D), "*"); 
            };
            
            
            function goToIndex(){
                window.location.href = "index.html"; 
            }   
        </script>   

        
        <div style="margin-top: 10vh;">
            <button onclick="goToIndex()"> Home Page Server One </button>
        </div>
    </body>
</html> 