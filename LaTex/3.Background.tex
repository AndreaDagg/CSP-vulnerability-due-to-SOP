\section{Background}
\justifying
In questa sezione andiamo a descrivere le caratteristiche che contraddistingue le \href{Origin}{origini}, la \href{chap:sameorigin}{Same-Origin-Policy (SOP)} e la \href{chap:contentsecpolicy}{Content-Security-Policy (CSP)}. 
\subsection{Origine, Dominio e Sub-Dominio}
\label{Origin}
In una comunicazione client-server il punto iniziale sta nel digitare un URL: 
\begin{center}
    \small\textit{http://www.main.com:80/dir/A.html}
\end{center}le risorse
Con il termine \textbf{Origin} si va ad identificare la terna: \textit{schema} (http), \textit{host} (main.com), \textit{porta} (81). Mentre l'ultima sezione, "/dir/A.html", va a definire la path del file indirizzato.\\
Per distinguere univocamente un indirizzo web si utilizzano i domini, nell'esempio precedente corrisponde all'host "main.com". A loro volta i domini possono essere suddivisi in sottodomini questi sono gerarchicamente inferiori e vengono utilizzati per definire in maniera più logica la struttura del sito web. Un esempio: 
\begin{center}
    \small\textit{http://www.sub.main.com}
\end{center}    

\subsection{Same Origin Policy}
\label{chap:sameorigin}
Come detto al paragrafo \ref{Origin}, una origine è formata dalla terna schema, host e porta. Una specifica utilizzata per proteggere i contenuti è la Same Origin Policy (SOP), questa consente ai programmatori di isolare i contenuti ritenuti non fidati \textit{(untrusted)}
provenienti da origini differenti. Questo meccanismo presente nei browser mantiene quindi al sicuro le informazioni relative ad un'origine (file .js, cookie, layout, ...) consentendone l'accesso solamente se l'origine di una richiesta è la stessa dei dati memorizzati. Senza l'implementazione di questa policy un utente malintenzionato potrebbe sfruttare i linguaggi di scripting per accedere a tali informazioni. \\
Suponendo di avere il seguente URL: 
\begin{center}
    \small\textit{http://main.com/dir/A.html}
\end{center}
Avremo come origine \textit{http://main.com}, se la porta non è specificata sarà la porta di default dello schema, nel caso dell'Http, la porta 80. Di seguito nella tabella \ref{tab:SOPTABLE1} possiamo osservare varie casistiche che descrivono il comportamento della Same Origin Policy. 

\begin{table}[h] % Utilizzo di [h] per posizionare la tabella "qui"
\centering % Centra la tabella
% Inizia la tabella
\begin{tabular}{|c|c|} % specifica il formato delle colonne (centrate, con linea verticale tra di loro)
\hline % linea orizzontale superiore della tabella
\rowcolor{gray!30} % Colora l'intera riga con il 50% del grigio
URL & Violazione SOP  \\ % contenuto della tabella
\hline % linea orizzontale sotto l'intestazione delle colonne
http://main.com/\textbf{dir2}/A.html & No \\
http://main.com/\textbf{dir/dir2}/A.html & No \\
\textbf{https}://main.com/dir/A.html & Si, schema differente \\
http://main.com:\textbf{81}/dir/A.html & Si, porta differente \\
http://\textbf{sub.}main.com/dir/A.html & Si, host differente \\
\hline % linea orizzontale inferiore della tabella
\end{tabular}
\caption{Comparazioni violazioni SOP} % Didascalia della tabella
\label{tab:SOPTABLE1} % Etichetta per referenziare la tabella
\end{table}

\subsection{Content Security Policy}
\label{chap:contentsecpolicy}
Con la Content-Security-Policy, si sposta l'attenzione al controllo, lato client, delle risorse che possono essere caricate ed eseguite all'interno di una pagina nel browser. Ad oggi CSP è supportato da tutti i principali browser \cite{3}.\\
La Content-Security-Policy è un ulteriore livello di sicurezza il cui obiettivo primario è quello di mitigare gli attacchi Cross-Site-Scripting (XSS). Consente agli sviluppatori di specificare e controllare quale risorsa client-side possa essere caricata ed eseguita dai browser. In questo modo si previene l'accesso al contenuto dalle risorse considerate \textit{untrusted}.\\
Per definire una politica CSP si può procedere configurando il web-server definito gli Header response HTTP oppure specificando le direttive nei tag \textit{$<meta>$} dell'HTML come nell'esempio in Listing \ref{meta-csp-def-ex} 

\begin{lstlisting}[
    language=HTML,
    caption=Esempio definizione CSP nel tag meta,
    label=meta-csp-def-ex,
    backgroundcolor=\color{codegray}, % Colore di sfondo
    frame=tb, % Visualizzazione del bordo intorno al codice
    frameround=ffff, % Stile del bordo
    framesep=15pt, % Spazio tra il bordo e il contenuto
    xleftmargin=15pt, % Margine sinistro
    xrightmargin=15pt, % Margine destro
    keywordstyle=\color{tagblue}\bfseries,
    morekeywords={html, head, title, body, h1, p}, % Aggiunta di nuove parole chiave (tag HTML)
    basicstyle=\fontsize{8}{9}\selectfont\ttfamily, % Modifica del font e della dimensione del carattere 
]
<html>
<head>
    <meta http-equiv ="Content-Security-Policy"
          content ="default-src 'self'; 
                    img-src https://*;
                    script-src 'none';">
</head>
</html>
\end{lstlisting}
Le direttive che si possono definire sono molteplici in tabella \ref{tab:directives} vengono elencate le più comuni.
\begin{table}[h] % Utilizzo di [h] per posizionare la tabella "qui"
\centering % Centra la tabella
 {\fontsize{9}{10}\selectfont % Imposta la dimensione del testo 
    \begin{tabular}{|c|c|}
    \hline % linea orizzontale superiore della tabella
    \rowcolor{gray!30} % Colora l'intera riga con il 50% del grigio
        \textbf{Directive} & \textbf{Controlled content} \\
        \hline
        \texttt{script-src} & Scripts \\
        \texttt{default-src} & All resources (fallback) \\
        \texttt{style-src} & Stylesheets \\
        \texttt{img-src} & Images \\
        \texttt{font-src} & Fonts \\
        \texttt{connect-src} & XMLHttpRequest, WebSocket, or EventSource \\
        \texttt{object-src} & Plug-in formats (object, embed) \\
        \texttt{report-uri} & URL where to report CSP violations \\
        \texttt{media-src} & Media (audio, video) \\
        \texttt{child-src} & Documents (frames), [Shared] Workers \\
        \texttt{frame-ancestors} & Embedding context \\
        \hline
    \end{tabular}
    }
\caption{Direttive CSP più comuni} % Didascalia della tabella
\label{tab:directives} % Etichetta per referenziare la tabella
\end{table}
Entrando più nello specifico abbiamo che la direttiva \textit{script-src} è la più utilizzata, questa definisce da quali origini è consentito caricare e eseguire script all'interno di una pagina web andando a definire uno o più attributi come: 
\begin{itemize}
    \item \textit{'self':} consente l'esecuzione di script dalla stessa origine;
    \item \textit{'http://example.com':} consente l'esecuzione di script dall'origine specificata;
    \item \textit{'none':} direttiva molto restrittiva che non consente l'esecuzione di alcuna tipologia di script; 
\end{itemize}
Quando si va a definire la direttiva \textit{scritp-src}, oltre a non poter importare file o snippet di scripting untrusted, non sarà possibile eseguire gli script-inline ovvero script eseguiti direttamente nel codice HTML attraverso il tag $<script>$ oppure gli handlers 'onclick' ed 'onload'. Questa caratteristica può essere rimossa andando a specificare l'attributo 'unsafe-inline'. Tuttavia utilizzarlo è considerato un comportamento non sicuro in quanto qualsiasi script può essere introdotto ed eseguito. 
\subsubsection{CSP e XSS Attack}
La Content-Security-Policy va quindi a mitigare la possibilità di riuscita di attacchi di tipo Cross-Site-Scripting (XSS). In questa tipologia di attacchi un utente malintenzionato mira a sfruttare una vulnerabilità all'interno di una pagina web per iniettare e far eseguire degli script dannosi. Dando la possibilità agli sviluppatori di poter definire tramite CSP quali risorse possono essere eseguite all'interno della pagina web e quindi potendo controllare le origini che possono caricare script, immagini e style si riduce di molto la potenziale riuscita di injection di codice malevolo. 

%\subsection{Vulnerabilità}
